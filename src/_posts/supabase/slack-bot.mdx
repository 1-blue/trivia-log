---
id: 00000000-0000-0000-0000-000020240929
title: slack bot ë§Œë“¤ê¸°
description: slackê³¼ supabaseë¥¼ ì´ìš©í•œ ì•Œë¦¼ ê¸°ëŠ¥ êµ¬í˜„í•œ ë°©ë²•ì— ëŒ€í•œ ê²Œì‹œê¸€
tags: [supabase, slack, bot, function, trigger]
icon: ''
thumbnail: '/images/posts/supabase/slack-bot/00-thumbnail.gif'
date: 2024-09-29 14:25:00
sitemap:
  lastmod: 2024-09-29 14:25:00
  changefreq: weekly
  priority: 0.5
draft: false
---

> `slack`ê³¼ `supabase`ì— ëŒ€í•´ì„œëŠ” ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.<br />
> ë¸”ë¡œê·¸ ê²Œì‹œê¸€ì— ëŒ“ê¸€/ë‹µê¸€ì´ ì¶”ê°€ë˜ë©´ `slack`ìœ¼ë¡œ ì•Œë¦¼ì´ ì˜¤ë„ë¡ êµ¬í˜„í•œ ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ’£ slack ì„¸íŒ…
### workspace ìƒì„±
1. [slack](https://slack.com/intl/ko-kr)ì—ì„œ `workspace` ìƒì„±

### slack app ë§Œë“¤ê¸°
![01-slack-app](/images/posts/supabase/slack-bot/01-slack-app.png)

1. [slack api](https://api.slack.com/apps)ì— ì ‘ê·¼
2. `Create New App` ì„ íƒ
3. `From scratch` ì„ íƒ
4. ë°ì´í„° í¼ì— ë§ê²Œ ì…ë ¥

### slack bot ì„¤ì •
![02-slack-bot](/images/posts/supabase/slack-bot/02-slack-bot.png)

1. `OAuth & Permissions` ì´ë™
2. `Scopes` > `Bot Token Scopes` > `Add an OAuth Scope`
    1. `chat:write` ì¶”ê°€
    2. `channels:read` ì¶”ê°€
4. `Install App` ì´ë™
5. `Reinstall to "Your Workspace"` í´ë¦­

### web hook ì„¤ì •
![03-slack-web-hook](/images/posts/supabase/slack-bot/03-slack-web-hook.png)

1. `Incomming Webhook` ì´ë™
2. í™œì„±í™”
3. `Add New Webhook to Workspace` í´ë¦­
4. ì±„ë„ ì„ íƒ
5. `Webhook URL` ë³µì‚¬

## ğŸ§¨ supabase ì„¸íŒ…
> ì•„ë˜ì™€ ê°™ì€ í…Œì´ë¸”ì´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

![04-comments-table](/images/posts/supabase/slack-bot/04-comments-table.png)

```sql
create table
  public.comments (
    id uuid not null default gen_random_uuid (),
    content text not null,
    created_at timestamp with time zone not null default now(),
    user_id uuid not null,
    post_id uuid not null,
    constraint comments_pkey primary key (id),
    constraint comments_post_id_fkey foreign key (post_id) references posts (id) on update cascade on delete cascade,
    constraint comments_user_id_fkey foreign key (user_id) references users (id) on update cascade on delete cascade
  ) tablespace pg_default;
```

### Extensions ì„¤ì¹˜
> `pg_net`ì€ ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ì—ì„œ API ìš”ì²­ì„ í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” `Extension`ì…ë‹ˆë‹¤.

![05-supabase-extension](/images/posts/supabase/slack-bot/05-supabase-extension.png)

1. `Extensions` ì´ë™
2. `pg_net` ì„¤ì¹˜

### Function ìƒì„±
> `Function`ì€ `supabase`ì—ì„œ ì œê³µí•˜ëŠ” ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ì…ë‹ˆë‹¤.<br />
> `plpgsql`ë¼ëŠ” ì–¸ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

![06-supabase-function](/images/posts/supabase/slack-bot/06-supabase-function.png)

1. `Database` > `Functions` ì´ë™
2. `Create a new Function` í´ë¦­
    1. `Schema`: `public`
    2. `Return Type`: `trigger`
    3. `Definition`: `plpgsql` ë¬¸ë²•ì˜ ì½”ë“œ ì…ë ¥ ( ì•„ë˜ ì½”ë“œ ì…ë ¥ )
1. `DECLARE`: ë³€ìˆ˜ ì„¤ì •
2. `BEGIN` ~ `END`: í•¨ìˆ˜ ì‹¤í–‰ ë¶€ë¶„
2. `NEW`: `trigger`ê°€ ë°œìƒí•œ ë°ì´í„°

```sql
-- ì‹¤ì œ ì½”ë“œëŠ” ë” ë³µì¡í•´ì„œ ë‹¨ìˆœí™”í•œ ì½”ë“œì…ë‹ˆë‹¤
DECLARE
  payload JSONB;
  slack_webhook_url TEXT := 'ì•„ê¹Œ ë³µì‚¬í•œ webhook url';
BEGIN
  payload := json_build_object(
    'text',
    format('ëŒ“ê¸€ ë‚´ìš©: %s', NEW.content)
  );

  PERFORM net.http_post(
    url := slack_webhook_url,
    body := payload,
    headers := '{"Content-Type": "application/json"}'::jsonb
  );

  RETURN NEW;
END;
```

### Trigger ìƒì„±
> `Trigger`ëŠ” ì„¤ì •í•œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì„¤ì •í•œ `Function`ì„ ì‹¤í–‰í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.

![07-supabase-trigger](/images/posts/supabase/slack-bot/07-supabase-trigger.png)

1. `Table`: ì›í•˜ëŠ” í…Œì´ë¸” ì„ íƒ
2. `Events`: ì›í•˜ëŠ” ì´ë²¤íŠ¸ ì„ íƒ ( í•„ìëŠ” `Insert` ì„ íƒ )
3. `Orientation`: `Row`ë¡œ ë³€ê²½ ( ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ `Function`ì˜ `NEW`ì— ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ì§€ ì•ŠìŒ )
4. `Function to trigger`: ì•„ê¹Œ ìƒì„±í•œ `Function` ì„ íƒ
